<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Nightmare</title>
        <link
            href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body,
            html {
                margin: 0;
                padding: 0;
                font-family: "EB Garamond", serif;
                color: #8f8f8f;
                background-color: #000;
                height: 100%;
                overflow: hidden;
                cursor:
                    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><circle cx="8" cy="8" r="6" fill="%23000000" stroke="%23ffffff" stroke-width="1"/></svg>')
                        8 8,
                    auto;
            }

            .nightmare-container {
                position: relative;
                width: 100%;
                height: 100vh;
                overflow: hidden;
                background-color: #000;
            }

            /* Text that occasionally appears */
            .flash-text {
                position: absolute;
                text-align: center;
                width: 100%;
                top: 50%;
                left: 0;
                transform: translateY(-50%);
                color: #ffffff;
                font-size: 3rem;
                opacity: 0;
                text-transform: uppercase;
                letter-spacing: 0.3em;
                font-weight: 400;
                text-shadow:
                    0 0 10px #fff,
                    0 0 20px #fff;
                pointer-events: none;
                z-index: 10;
                transition: opacity 0.1s ease;
            }

            /* White flash effect */
            .flash {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: white;
                opacity: 0;
                z-index: 5;
                pointer-events: none;
            }

            /* Static noise overlay */
            .static-noise {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                opacity: 0.05;
                z-index: 3;
                pointer-events: none;
                background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXWBgYGHh4d5eXlzc3OLi4ubm5uVlZWPj4+NjY19fX2JiYl/f39ra2uRkZGZmZlpaWmXl5dvb29xcXGTk5NnZ2c4zIypAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgvJEaAAAAVklEQVRIx+3RSRaAIAxE0b5EEESUGcf7X9eo4GqXsR8B10+W2jLEwM0DmE0PQgFnmO1MWXMTyF1K3LFHD8AXByGVLtghjWmB3YE1oHB4MVaVwJSKZYuB2bw7APsPy4I/JCIYAAAAAElFTkSuQmCC");
            }

            /* Subtle vignette effect */
            .vignette {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                background: radial-gradient(
                    circle at center,
                    rgba(0, 0, 0, 0) 10%,
                    rgba(0, 0, 0, 0.8) 80%,
                    rgba(0, 0, 0, 1) 100%
                );
                z-index: 2;
            }

            /* Wake up button (sangat kecil dan bergerak, sepenuhnya tidak terlihat) */
            .wake-up-btn {
                position: fixed;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);
                background: none;
                border: 1px solid rgba(255, 255, 255, 0);
                color: rgba(255, 255, 255, 0);
                font-family: "EB Garamond", serif;
                font-size: 0.65rem;
                padding: 5px 10px;
                cursor: pointer;
                transition: all 0.5s ease;
                letter-spacing: 0.2em;
                text-transform: uppercase;
                z-index: 20;
                opacity: 0;
            }

            .wake-up-btn:hover {
                background: rgba(255, 255, 255, 0.05);
                color: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.1);
                opacity: 0.2;
                padding: 8px 16px;
                font-size: 0.7rem;
                transform: none;
            }

            /* Breathing animation */
            @keyframes breathe {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            /* Distortion effect for text */
            @keyframes textDistort {
                0%,
                100% {
                    transform: skew(0deg);
                    opacity: 1;
                }
                25% {
                    transform: skew(-5deg);
                    opacity: 0.9;
                }
                75% {
                    transform: skew(5deg);
                    opacity: 0.8;
                }
            }

            /* Hidden whispers */
            .whisper {
                position: absolute;
                color: rgba(255, 255, 255, 0.1);
                font-size: 0.8rem;
                pointer-events: none;
                opacity: 0;
                z-index: 4;
                transition: opacity 0.5s ease;
            }
            
            /* Tombol kontrol musik */
            .music-control {
                position: absolute;
                bottom: 10px;
                right: 10px;
                padding: 5px;
                font-size: 0.6rem;
                background: transparent;
                color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.05);
                border-radius: 3px;
                cursor: pointer;
                opacity: 0.07;
                transition: all 0.3s ease;
                z-index: 100;
            }
            
            .music-control:hover {
                opacity: 0.2;
                color: rgba(255, 255, 255, 0.3);
                border-color: rgba(255, 255, 255, 0.1);
            }

            @media (max-width: 768px) {
                .flash-text {
                    font-size: 1.8rem;
                    letter-spacing: 0.2em;
                }

                /* Tombol escape di mobile tetap kecil dan tidak terlihat */
                .wake-up-btn {
                    font-size: 0.65rem;
                    padding: 5px 10px;
                    opacity: 0;
                }

                /* Tombol escape di mobile saat hover */
                .wake-up-btn:hover {
                    padding: 8px 16px;
                    font-size: 0.7rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="nightmare-container">
            <!-- Flash overlay -->
            <div class="flash" id="flash"></div>

            <!-- Text that appears during flashes -->
            <div class="flash-text" id="flashText"></div>

            <!-- Random whispers -->
            <div id="whispers"></div>

            <!-- Static noise overlay -->
            <div class="static-noise"></div>

            <!-- Vignette effect -->
            <div class="vignette"></div>

            <!-- Wake up button -->
            <button id="wakeUpBtn" class="wake-up-btn">Escape</button>
            
            <!-- Music control button -->
            <button id="musicControlBtn" class="music-control">Music: On</button>
            
            <!-- Background music (hidden) -->
            <audio id="backgroundMusic" loop preload="auto" style="display: none;">
                <source src="/audio/creepy-music-box.mp3" type="audio/mpeg">
            </audio>
        </div>

        <script>
            // Messages that can appear during flashes
            const flashMessages = [
                "WAKE UP",
                "IT'S JUST A DREAM",
                "YOU'RE NOT REAL",
                "THERE IS NO ESCAPE",
                "YOU'RE TRAPPED",
                "DON'T TRUST THEM",
                "THEY'RE WATCHING",
                "REMEMBER WHO YOU ARE",
                "THE DARKNESS CONSUMES",
                "YOU'VE BEEN HERE BEFORE",
                "YOU CANNOT LEAVE",
            ];

            // Whispers content (now 175+ eerie lines)
            const whisperTexts = [
                "help me",
                "it's cold here",
                "have you forgotten?",
                "we're still waiting",
                "come back to us",
                "remember the promise",
                "don't leave us again",
                "you abandoned us",
                "the fire is dying",
                "it's your fault",
                "we can see you",
                "behind you",
                "listen carefully",
                "you never escaped",
                "this isn't over",
                "do you hear it too?",
                "they're watching",
                "your shadow lied",
                "the door is open",
                "you were warned",
                "nothing is real",
                "i remember your face",
                "why did you run?",
                "closer... just a little closer",
                "we never stopped screaming",
                "you shouldn't have looked",
                "don't trust the light",
                "it breathes with you",
                "the silence is hungry",
                "we became the dark",
                "you are the last one",
                "time is breaking",
                "your name is fading",
                "this place remembers",
                "you are not alone… but you should be",
                "even the dead are afraid",
                "it's listening through you",
                "we still feel the fire",
                "your heartbeat lies",
                "we never died",
                "there is no way out",
                "we forgave you... once",
                "we are what's left",
                "open your eyes",
                "don't blink",
                "the sky is cracking",
                "it wants your name",
                "she never stopped crying",
                "they're not asleep",
                "you made us wait",
                "the walls are whispering too",
                "did you hear that?",
                "we were here first",
                "your skin remembers",
                "we know your thoughts",
                "stop pretending",
                "it sees through you",
                "your breath is not yours",
                "we’re already inside",
                "the mirror lied",
                "you called us",
                "we never left",
                "we woke up for you",
                "you feel it crawling, don’t you?",
                "you belong here now",
                "this isn’t your dream",
                "we lost the way",
                "you forgot how it ends",
                "the ground is hollow",
                "you are repeating again",
                "shhh… it’s almost here",
                "the stars are wrong",
                "you brought it with you",
                "where is your face?",
                "the cold remembers",
                "the whispers are growing",
                "you never had a choice",
                "don’t listen to yourself",
                "it was always you",
                "something is missing",
                "you left it open",
                "we are all broken here",
                "your voice cracks too easily",
                "the silence is full of teeth",
                "you made it worse",
                "it’s not over until you forget",
                "do you hear the scratching?",
                "it knows you're awake",
                "everything here is watching",
                "you forgot the ending",
                "something followed you",
                "they're inside the walls",
                "your dream is leaking",
                "we never wanted your help",
                "you left the door wide open",
                "it’s waiting behind your eyes",
                "we loved you once",
                "it hates the light you carry",
                "you don’t belong in this skin",
                "where did you bury us?",
                "the voices are multiplying",
                "your silence is too loud",
                "you let it in",
                "we miss the screaming",
                "you blinked too soon",
                "your hands aren’t yours anymore",
                "you’re becoming something else",
                "you keep waking up wrong",
                "it remembers your heartbeat",
                "don't close your eyes now",
                "you left a piece of you behind",
                "we were never human",
                "you dream in our language now",
                "the echoes are feeding",
                "you were warned—again and again",
                "your guilt stinks of fire",
                "you taste like regret",
                "we hear you breathing",
                "you are the crack in the mirror",
                "you promised us forever",
                "we whispered first",
                "it's learning your name",
                "don't let it answer",
                "you never came alone",
                "the floor is listening",
                "you opened it, now seal it",
                "we will finish what you started",
                "your reflection lied",
                "you’ll never be clean again",
                "we remember the cold",
                "your dreams are infected",
                "you wrote this ending",
                "it’s behind your thoughts",
                "we stitched your name into this place",
                "you walked into memory",
                "you made this real",
                "the air is thicker now",
                "you’ve been heard",
                "your silence gave it shape",
                "we're whispering through you",
                "it’s almost your turn",
            ];

            // Maximum number of whispers at once
            const MAX_WHISPERS = 9999;

            // Menambahkan teks bisikan yang "glitch" - dengan karakter berantakan
            const glitchWhisperTexts = [
                "c̵̭͖̐́ͣo̝͚͞m̤͔e̴̛͚͂ ̗̌͌̀b̩̫̎͋a̮͚̪̐c̢̤͓̊ͧ͡k̻̠̑́͟",
                "ḫ̷ͫ͠e͎̋ͩ͒l̉̔̑͐p̧̟͌ͅ ̢̹̻ͅu̼̙͌̈͝s͕̈",
                "ḓ̨ͅǫ̢̪n̆̄ͅ'̶̘̅ͅt̶̥̖͈͑ ̢̟͖̿͐l̶̝̤̆̀ȯ͎̗o̢̻̟̔k̢̛̲͉̔",
                "y̶̬̆̿͂o̲̊͊͜͜u̶͎͐͞ ̸̱̦̱͛c̼̿̿͡a̛͙ͅn̴̛̠̩ͅ't̡̠̀ͅ ̰͓̍̕e̛̦̰͐́s̵̱̘̀͡c̔͢ͅa̭̙͇͊p̶̡̱̙̽e̲̙̎̑",
                "w̧̮̿͋̌e̠̊̎̄ ̰̳̩̑a̧̝̩ͅr̵̟̬ͅe̞͡͝ ̠̓͗͡w̧̛̜ͅa̡̪̪̓ͅt̺ͅc̢̠ͅh̨̙͕̓i̙̗̓ͅn̠̰ͅg̩̾͢ͅ",
                "̨͓̤͛͘h̴͕̫̻͗e̥͙̔ͬͅl̴͖̬̦̃p̹͚̩͘͟ ̟̓ͯ͒͝m̡̟̼̆ͨe͉̫͈ͮ̕",
                "̶̯̫̱ͤṅ̴͕̱̩̂o͕̝̙͗̕ ̶̵̨̯̒e̷̫̹̱͊s̡̩̰̮͂c̛̣̪͕͒ä̡̛̰͖́p̘̳ͮͨ͘e̻̥̜̅͜",
                "͓̭͂ͯ͞i̧̪̳̊͋t̤̥̜͆͡'̸̭͙ͩͬs̵̳̥ͣͤ ̓͏̻̥̥a͓̭̯͑͘l͎̱̭̆̕l̷̗̣̃́ ̫̰̋ͭ͞y̨͙͓̏̉ŏ̷̬̤̘ͧuͤ͏̣͕̙r̵̫̮̲̓ ̜̘͙̂͠f̙̪̘̉͠a̮̫͔̎͟u̴̻̻̓͠l͚̹̾ͬ͝t̞̪ͥ͑͜"
            ];
            
            // CSS untuk efek glitch pada teks
            const glitchStyles = document.createElement('style');
            glitchStyles.innerHTML = `
                @keyframes glitchEffect {
                    0% { opacity: 0.2; transform: translate(-2px, 2px); }
                    25% { opacity: 0.5; transform: translate(2px, -2px); filter: hue-rotate(90deg); }
                    50% { opacity: 0.3; transform: translate(-1px, -1px); filter: hue-rotate(180deg); }
                    75% { opacity: 0.4; transform: translate(1px, 1px); filter: hue-rotate(270deg); }
                    100% { opacity: 0.2; transform: translate(-2px, 2px); }
                }
                
                .whisper.glitch {
                    animation: glitchEffect 0.3s infinite;
                    color: rgba(255, 255, 255, 0.7);
                    font-family: monospace;
                    letter-spacing: -1px;
                    text-shadow: 0 0 5px rgba(255, 0, 0, 0.5), 0 0 10px rgba(0, 0, 255, 0.3);
                }
            `;
            document.head.appendChild(glitchStyles);

            // Create random whispers
            function createWhispers() {
                const container = document.getElementById("whispers");

                for (let i = 0; i < MAX_WHISPERS; i++) {
                    const whisper = document.createElement("div");
                    whisper.className = "whisper";
                    
                    // Tentukan apakah ini akan menjadi teks biasa atau glitch (20-30% kemungkinan glitch)
                    const isGlitch = Math.random() < (Math.random() * 0.1 + 0.2); // 20-30% kemungkinan
                    
                    let text;
                    if (isGlitch) {
                        // Pilih teks glitch acak
                        const glitchIndex = Math.floor(Math.random() * glitchWhisperTexts.length);
                        text = glitchWhisperTexts[glitchIndex];
                        whisper.classList.add('glitch'); // Tambahkan class glitch untuk efek visual
                    } else {
                        // Pilih teks bisikan normal
                        const randomIndex = Math.floor(Math.random() * whisperTexts.length);
                        text = whisperTexts[randomIndex];
                    }
                    
                    whisper.textContent = text;
                    whisper.dataset.isGlitch = isGlitch; // Simpan status glitch untuk animasi

                    // Random position
                    const randomX = Math.random() * 100;
                    const randomY = Math.random() * 100;

                    whisper.style.left = `${randomX}%`;
                    whisper.style.top = `${randomY}%`;
                    whisper.style.transform = `rotate(${Math.random() * 40 - 20}deg)`;

                    container.appendChild(whisper);
                }
            }

            // Play audio for whisper text
            async function playWhisperAudio(text) {
                try {
                    // Menambahkan pengaturan suara yang lebih realistis untuk bisikan
                    const stability = Math.random() * 0.2 + 0.3; // Stabilitas rendah (0.3-0.5) untuk efek suara lebih tidak stabil
                    const similarity_boost = Math.random() * 0.3 + 0.7; // 0.7-1.0
                    const style = Math.random() * 0.4 + 0.4; // 0.4-0.8 untuk gaya yang lebih ekspresif
                    const speaking_rate = Math.random() * 0.3 + 0.8; // Kecepatan bicara bervariasi (0.8-1.1)

                    const response = await fetch(
                        "/api/elevenlabs/text-to-speech",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                text: text,
                                voice_id: "Q5lUbL40rnWTcPncLVzc", // Menggunakan ID voice yang diminta
                                model_id: "eleven_monolingual_v1",
                                voice_settings: {
                                    stability: stability,
                                    similarity_boost: similarity_boost,
                                    style: style,
                                    use_speaker_boost: true,
                                    speaking_rate: speaking_rate,
                                },
                            }),
                        },
                    );

                    const data = await response.json();

                    if (data.success && data.audioPath) {
                        const audio = new Audio(data.audioPath);

                        // Volume bervariasi untuk menambah kesan yang lebih realistis
                        audio.volume = Math.random() * 0.25 + 0.15; // Volume antara 0.15-0.4

                        // Menambahkan efek suara stereo acak (kiri/kanan) untuk sensasi "kerumunan"
                        const audioContext = new (window.AudioContext ||
                            window.webkitAudioContext)();
                        const source =
                            audioContext.createMediaElementSource(audio);
                        const stereoPanner = audioContext.createStereoPanner();

                        // Posisi stereo acak untuk menimbulkan kesan suara dari berbagai arah
                        stereoPanner.pan.value = Math.random() * 2 - 1; // Nilai -1 (kiri) hingga 1 (kanan)

                        source.connect(stereoPanner);
                        stereoPanner.connect(audioContext.destination);

                        audio.play();
                    }
                } catch (error) {
                    console.error("Error playing whisper audio:", error);
                }
            }

            // Show random whispers occasionally
            function animateWhispers() {
                const whispers = document.querySelectorAll(".whisper");
                let lastWhisperTime = 0;
                let whisperCount = 0;
                const MAX_CONCURRENT_WHISPERS = 3; // Maksimum 3 bisikan bersamaan

                setInterval(() => {
                    const now = Date.now();
                    const timeSinceLastWhisper = now - lastWhisperTime;

                    // Reset whisper count if there's been a significant gap
                    if (timeSinceLastWhisper > 3000) {
                        whisperCount = 0;
                    }

                    // Peluang lebih tinggi untuk bisikan muncul
                    const shouldShowWhisper = Math.random() < 0.3;

                    // Tampilkan bisikan jika tidak melebihi batas maksimum bersamaan
                    if (
                        shouldShowWhisper &&
                        whisperCount < MAX_CONCURRENT_WHISPERS
                    ) {
                        // Kapan bisikan serentak akan muncul (lebih tinggi = lebih jarang)
                        const isMultipleWhispers = Math.random() < 0.15;

                        // Jumlah bisikan yang akan ditampilkan bersamaan
                        const whispersToShow = isMultipleWhispers
                            ? Math.floor(Math.random() * 2) + 2
                            : 1; // 2-3 jika bersamaan, atau 1 jika tidak

                        // Memilih bisikan yang berbeda untuk ditampilkan
                        const usedIndices = new Set();
                        const usedTexts = new Set();
                        const usedGlitchTexts = new Set();

                        for (
                            let i = 0;
                            i < whispersToShow &&
                            whisperCount < MAX_CONCURRENT_WHISPERS;
                            i++
                        ) {
                            // Memilih elemen bisikan yang belum digunakan
                            let randomIndex;
                            do {
                                randomIndex = Math.floor(
                                    Math.random() * whispers.length,
                                );
                            } while (usedIndices.has(randomIndex));
                            usedIndices.add(randomIndex);

                            const whisper = whispers[randomIndex];
                            
                            // Tentukan apakah ini akan menjadi teks glitch (20-30% kemungkinan)
                            const isGlitch = Math.random() < (Math.random() * 0.1 + 0.2);
                            
                            // Reset class
                            whisper.className = "whisper";
                            if (isGlitch) {
                                whisper.classList.add('glitch');
                            }
                            
                            let whisperText;
                            
                            if (isGlitch) {
                                // Pilih teks glitch yang belum digunakan
                                do {
                                    whisperText = glitchWhisperTexts[
                                        Math.floor(Math.random() * glitchWhisperTexts.length)
                                    ];
                                } while (usedGlitchTexts.has(whisperText));
                                usedGlitchTexts.add(whisperText);
                            } else {
                                // Pilih teks bisikan normal yang belum digunakan
                                do {
                                    whisperText = whisperTexts[
                                        Math.floor(Math.random() * whisperTexts.length)
                                    ];
                                } while (usedTexts.has(whisperText));
                                usedTexts.add(whisperText);
                            }

                            whisper.textContent = whisperText;
                            
                            // Teks glitch muncul dengan opacity yang sedikit lebih tinggi
                            whisper.style.opacity = isGlitch 
                                ? Math.random() * 0.3 + 0.1  // 0.1-0.4 untuk glitch
                                : Math.random() * 0.1 + 0.05; // 0.05-0.15 untuk normal

                            // Posisi acak
                            const randomX = Math.random() * 100;
                            const randomY = Math.random() * 100;
                            whisper.style.left = `${randomX}%`;
                            whisper.style.top = `${randomY}%`;
                            whisper.style.transform = `rotate(${Math.random() * 40 - 20}deg)`;

                            // Hanya putar audio untuk teks normal, bukan untuk teks glitch
                            if (!isGlitch) {
                                // Putar audio untuk bisikan normal dengan jeda sedikit agar tidak tepat bersamaan
                                setTimeout(
                                    () => {
                                        playWhisperAudio(whisperText);
                                    },
                                    i * (Math.random() * 300 + 50),
                                ); // Jeda 50-350ms antar suara
                            } else {
                                // Untuk teks glitch, buat efek suara glitch jika diperlukan nanti
                                // (Tidak diimplementasi sekarang untuk menjaga fokus pada efek visual)
                            }

                            // Sembunyikan setelah beberapa saat
                            // Teks glitch bertahan lebih singkat
                            const displayDuration = isGlitch 
                                ? Math.random() * 1500 + 1000 // 1-2.5 detik untuk glitch
                                : Math.random() * 3000 + 2000; // 2-5 detik untuk normal
                                
                            setTimeout(
                                () => {
                                    whisper.style.opacity = 0;
                                    whisperCount--;
                                },
                                displayDuration
                            );

                            whisperCount++;
                        }

                        lastWhisperTime = now;
                    }
                }, 700); // Interval sedikit lebih lama agar tidak terlalu sering
            }

            // Play audio for flash messages with more volume and intensity than whispers
            async function playFlashAudio(text) {
                try {
                    // Use the same specific voice ID but with higher volume for flash messages
                    const response = await fetch(
                        "/api/elevenlabs/text-to-speech",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                text: text,
                                voice_id: "Q5lUbL40rnWTcPncLVzc", // Menggunakan ID voice yang diminta
                                model_id: "eleven_monolingual_v1",
                                voice_settings: {
                                    stability: 0.3, // Less stable for more erratic sound
                                    similarity_boost: 0.75,
                                    style: 0.5, // More intense style
                                    speaking_rate: 1.15, // Slightly faster for urgency
                                },
                            }),
                        },
                    );

                    const data = await response.json();

                    if (data.success && data.audioPath) {
                        const audio = new Audio(data.audioPath);
                        audio.volume = 0.4; // Lebih keras dari bisikan
                        audio.play();
                    }
                } catch (error) {
                    console.error("Error playing flash audio:", error);
                }
            }

            // Create white flashes
            function createFlashes() {
                const flash = document.getElementById("flash");
                const flashText = document.getElementById("flashText");

                // Create short flashes
                function createShortFlash() {
                    // Randomize flash timing
                    const flashDelay = Math.random() * 15000 + 5000; // 5-20 seconds between flashes

                    setTimeout(() => {
                        // Random flash duration
                        const duration = Math.random() * 200 + 50; // 50-250ms

                        // Flash settings
                        const flashIntensity = Math.random() * 0.5 + 0.2; // Vary opacity for different intensities
                        flash.style.opacity = flashIntensity;

                        // Menampilkan tombol escape dengan opacity rendah saat terjadi kilatan cahaya
                        const wakeUpBtn = document.getElementById("wakeUpBtn");

                        // Opacity tombol escape saat ada kilatan cahaya (10-20% dari intensitas flash)
                        const buttonOpacity =
                            flashIntensity * (Math.random() * 0.1 + 0.1);
                        wakeUpBtn.style.opacity = buttonOpacity;

                        // Sometimes show text with the flash
                        if (Math.random() < 0.4) {
                            // Random message
                            const messageIndex = Math.floor(
                                Math.random() * flashMessages.length,
                            );
                            const message = flashMessages[messageIndex];
                            flashText.textContent = message;
                            flashText.style.opacity = 1;
                            flashText.style.animation = `textDistort ${Math.random() * 0.5 + 0.2}s ease-in-out`;

                            // Buat tombol escape lebih jelas saat ada pesan flash
                            // Untuk kilatan dengan pesan flash, buat tombol jauh lebih terlihat (40-60% dari intensitas flash)
                            const enhancedButtonOpacity = flashIntensity * (Math.random() * 0.2 + 0.4);
                            wakeUpBtn.style.opacity = enhancedButtonOpacity;
                            
                            // Tambahkan tepian putih tipis untuk tombol saat pesan flash muncul
                            wakeUpBtn.style.borderColor = `rgba(255, 255, 255, ${enhancedButtonOpacity + 0.1})`;
                            wakeUpBtn.style.boxShadow = `0 0 8px rgba(255, 255, 255, ${enhancedButtonOpacity * 0.8})`;

                            // Tidak memainkan audio untuk pesan flash sesuai permintaan

                            // Hide text after flash
                            setTimeout(() => {
                                flashText.style.opacity = 0;
                                // Sembunyikan kembali tombol setelah pesan
                                wakeUpBtn.style.opacity = 0;
                                wakeUpBtn.style.borderColor = "rgba(255, 255, 255, 0)";
                                wakeUpBtn.style.boxShadow = "none";
                            }, duration + 50);
                        }

                        // Hide flash after duration
                        setTimeout(() => {
                            flash.style.opacity = 0;
                            // Sembunyikan kembali tombol escape
                            wakeUpBtn.style.opacity = 0;
                            // Schedule next flash
                            createShortFlash();
                        }, duration);
                    }, flashDelay);
                }

                // Create dramatic sequence of multiple flashes
                function createFlashSequence() {
                    // Longer delay between sequences
                    const sequenceDelay = Math.random() * 30000 + 20000; // 20-50 seconds between sequences

                    setTimeout(() => {
                        const flashCount = Math.floor(Math.random() * 3) + 2; // 2-4 flashes in sequence

                        // Show flash message with sequence
                        const messageIndex = Math.floor(
                            Math.random() * flashMessages.length,
                        );
                        const message = flashMessages[messageIndex];
                        flashText.textContent = message;

                        // Tidak memainkan audio untuk pesan flash sesuai permintaan

                        // Get the escape button
                        const wakeUpBtn = document.getElementById("wakeUpBtn");

                        // Create multiple flashes in sequence
                        for (let i = 0; i < flashCount; i++) {
                            setTimeout(
                                () => {
                                    // Higher intensity for sequences
                                    const flashIntensity =
                                        Math.random() * 0.7 + 0.3;
                                    flash.style.opacity = flashIntensity;
                                    flashText.style.opacity =
                                        0.8 + Math.random() * 0.2;

                                    // Menampilkan tombol escape selama urutan kilatan dengan opacity yang jauh lebih tinggi
                                    // Untuk urutan kilatan dalam sequence, buat tombol sangat terlihat (40-70% dari intensitas flash)
                                    const buttonOpacity =
                                        flashIntensity *
                                        (Math.random() * 0.3 + 0.4);
                                    wakeUpBtn.style.opacity = buttonOpacity;
                                    
                                    // Tambahkan efek glow yang lebih kuat untuk tombol saat sequence
                                    wakeUpBtn.style.borderColor = `rgba(255, 255, 255, ${buttonOpacity + 0.2})`;
                                    wakeUpBtn.style.boxShadow = `0 0 12px rgba(255, 255, 255, ${buttonOpacity * 0.9})`;
                                    
                                    // Buat warna text lebih jelas saat sequence
                                    wakeUpBtn.style.color = `rgba(255, 255, 255, ${buttonOpacity + 0.3})`;

                                    // Flicker effect
                                    setTimeout(
                                        () => {
                                            flash.style.opacity = 0;

                                            // Sembunyikan tombol kembali
                                            wakeUpBtn.style.opacity = 0;

                                            if (i === flashCount - 1) {
                                                // Last flash in sequence, hide text
                                                setTimeout(() => {
                                                    flashText.style.opacity = 0;
                                                }, 200);
                                            }
                                        },
                                        100 + Math.random() * 150,
                                    );
                                },
                                i * (Math.random() * 200 + 200),
                            ); // 200-400ms between flashes in a sequence
                        }

                        // Schedule next sequence
                        createFlashSequence();
                    }, sequenceDelay);
                }

                // Start both types of flashes
                createShortFlash();
                createFlashSequence();
            }

            // Wake up button functionality
            function setupWakeUpButton() {
                const wakeUpBtn = document.getElementById("wakeUpBtn");

                // Fungsi untuk mengubah posisi tombol secara acak
                function randomizeButtonPosition() {
                    // Mendapatkan dimensi jendela browser
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;

                    // Mengatur margin minimum dari tepi layar (dalam piksel)
                    const margin = 20;

                    // Menghasilkan posisi acak di dalam jendela browser dengan mempertimbangkan margin
                    const newX =
                        margin + Math.random() * (viewportWidth - margin * 2);
                    const newY =
                        margin + Math.random() * (viewportHeight - margin * 2);

                    // Mengatur ulang properti transform untuk menghilangkan efek translateX(-50%)
                    wakeUpBtn.style.transition = "all 0.3s ease";
                    wakeUpBtn.style.left = `${newX}px`;
                    wakeUpBtn.style.top = `${newY}px`;
                    wakeUpBtn.style.bottom = "auto";
                    wakeUpBtn.style.transform = "none";
                }

                // Mengubah posisi tombol setiap 5 detik
                randomizeButtonPosition(); // Posisi awal acak
                const positionInterval = setInterval(
                    randomizeButtonPosition,
                    5000,
                );

                wakeUpBtn.addEventListener("click", function () {
                    // Menghentikan interval perubahan posisi
                    clearInterval(positionInterval);

                    // Flash before exiting
                    const flash = document.getElementById("flash");
                    flash.style.opacity = 1;

                    // Fade out after a delay
                    setTimeout(function () {
                        document.body.style.transition = "opacity 2s ease-out";
                        document.body.style.opacity = "0";

                        // Redirect back to main page
                        setTimeout(function () {
                            window.location.href = "/";
                        }, 2000);
                    }, 300);
                });
            }

            // Fungsi untuk menginisialisasi dan mengontrol musik latar belakang
            function setupBackgroundMusic() {
                const backgroundMusic = document.getElementById("backgroundMusic");
                const musicControlBtn = document.getElementById("musicControlBtn");
                let isMusicPlaying = false;
                
                // Set volume musik sangat rendah - lebih rendah dari whisperTexts
                backgroundMusic.volume = 0.08; // Jauh lebih rendah dari volume bisikan (0.15-0.4)
                
                // Tambahkan event listener untuk mengontrol musik
                musicControlBtn.addEventListener("click", function() {
                    if (isMusicPlaying) {
                        backgroundMusic.pause();
                        musicControlBtn.textContent = "Music: Off";
                        isMusicPlaying = false;
                    } else {
                        backgroundMusic.play();
                        musicControlBtn.textContent = "Music: On";
                        isMusicPlaying = true;
                    }
                });
                
                // Auto-play musik setelah beberapa detik
                setTimeout(() => {
                    backgroundMusic.play()
                        .then(() => {
                            isMusicPlaying = true;
                        })
                        .catch(error => {
                            console.error("Musik tidak dapat diputar otomatis:", error);
                            // Kebijakan browser mungkin menghalangi autoplay
                            musicControlBtn.style.opacity = 0.2; // Buat tombol lebih terlihat jika autoplay gagal
                        });
                }, 1500);
            }

            // Initialize everything
            window.onload = function () {
                createWhispers();
                animateWhispers();
                createFlashes();
                setupWakeUpButton();
                setupBackgroundMusic();

                // Subtle breathing animation for the entire page
                document.body.style.animation =
                    "breathe 10s infinite ease-in-out";
            };
        </script>
    </body>
</html>
